<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>俄罗斯方块</title>
	<script src="jquery-1.12.0.js"></script>
	<style>
		*{margin: 0; padding: 0;}
		body{
			width: 100%;
		}
		.Box{
			width: 212px;			
			position: relative;
			left: 50%;
			margin-left: -100px;
			
		}
		table{
			position: absolute;
			top: 0;
			background: #000;
			border: 4px solid #ccc;			
		}
		td{
			width: 18px;
			height:18px;
			color: #fff;
			display: inline-block;
			border: 1px solid #333;
			
		}
		.active{
			background: #0f0;
		}
		.btn{
			width: 100px;
			height: 30px;
			line-height: 30px;
			text-align: center;
			position: absolute;
			left: 70px;
			bottom: -120px;
		}
	</style>
		<script>
		//方块形状
		//方块旋转
		//方块移动
		//边界
		$(function(){
			var arr=[	
						[[4,5,13,14],[4,14,15,25],[4,5,13,14],[4,14,15,25]],/*反Z*/
						[[4,14,24,34],[3,4,5,6],[4,14,24,34],[3,4,5,6]],/*一字型*/
						[[4,5,15,16],[5,14,15,24],[4,5,15,16],[5,14,15,24]],/*Z型*/
						[[4,5,6,15],[5,14,15,25],[5,14,15,16],[4,14,15,24]],/*T型*/
						[[4,14,24,25],[4,5,6,14],[4,5,15,25],[6,14,15,16]],/*L型*/
						[[4,14,23,24],[4,14,15,16],[4,5,14,24],[4,5,6,16]],/*反L型*/
						[[4,5,14,15],[4,5,14,15],[4,5,14,15],[4,5,14,15]]/*田字型*/
					];
			var num;
			var numbers;

			//定时器
			$('.btn').on('click',function(){
				var jifen=0;
				function fnKuai(){
					num=parseInt(Math.random()*arr.length);
					numbers=parseInt(Math.random()*4);
					for (var i = 0; i < 4; i++) {
						$('td').eq(arr[num][numbers][i]).addClass('active');
					};
				}
				fnKuai();
				// 整体想想下走一格,加10;
				var nTds=0;
				var bHasClass1;
				var bHasClass2;
				var bHasClass3;
				var bHasClass4;
				//定时器
				$('.Box')[0].timer=setInterval(function fnchudi(){	
					
					// 定时下落
					nTds += 10;		
						//定时下落在框内
						if (arr[num][numbers][3]+nTds<200) {						
							for (var i = 0; i < 4; i++) {						
								$('td').eq((arr[num][numbers][i]+nTds)-10).removeClass('active');					
							};
							bHasClass1=$('td').eq(arr[num][numbers][0]+nTds).hasClass('active');
							bHasClass2=$('td').eq(arr[num][numbers][1]+nTds).hasClass('active');
							bHasClass3=$('td').eq(arr[num][numbers][2]+nTds).hasClass('active');
							bHasClass4=$('td').eq(arr[num][numbers][3]+nTds).hasClass('active');
							//如果触到其他方块停止下落
							if (bHasClass1==true || bHasClass2==true ||bHasClass3==true || bHasClass4==true) {
								//	清除正在下落的方块
								for (var i = 0; i < 4; i++) {						
									$('td').eq((arr[num][numbers][i]+nTds)-10).addClass('active');			
								};
								//开始时判断是否到顶了
								if (arr[num][numbers][0]<10) {
									//游戏结束								
									if ($('td').eq(arr[num][numbers][3]+10).hasClass('active')||$('td').eq(arr[num][numbers][2]+10).hasClass('active')) {
										clearInterval($('.Box')[0].timer);
										alert('游戏结束!');
										nTds=0;	
									//正常下落								
									}else{
											
										nTds=0;
										fnKuai();		
									}								
								}
							//下方没有方块时下落														
							}else{
								//每行填满时消掉
										
								var arr2=[];
								var jiabei=0;
								for (var i = 0; i <20; i++) {
									var n=0;										
									for (var j = 0; j<10; j++) {
										
										if ($('td').eq(j+i*10).hasClass('active')) {
											n=n+1;
											arr2.push(j+i*10);
										};
										//当这一行填满时-------------------------------------------
										if (n==10) {
											for (var jj = 0; jj < arr2.length; jj++) {
												$('td').eq(arr2[jj]).removeClass('active')
											};
											for (var ii = 0; ii < 10; ii++) {
												arr2.pop();
											};
											
											for (var kk = 0; kk < arr2.length; kk++) {
												arr2[kk]=arr2[kk]+10;		
												$('td').eq(arr2[kk]).addClass('active')
											};
											jiabei++;
											jifen=jifen+jiabei*jiabei ;
											$('p').eq(1).text('积分为:'+jifen)
											
											
										}
									};
								};
								for (var i = 0; i < 4; i++) {							
									$('td').eq(arr[num][numbers][i]+nTds).addClass('active');
								}
							};
						//arr[num][numbers][3]+nTds超过	200  就是到框外面
						}else{
							for (var i = 0; i < 4; i++) {						
								$('td').eq((arr[num][numbers][i]+nTds)-10).addClass('active');			
							};
							fnKuai();
							nTds=0;						
						}
						
					
					
				},300);
				
				// keycode 37 = Left keycode 38 = Up keycode 39 = Right keycode 40 = Down
				$(document).on('keydown',function(e){
					var min=(arr[num][numbers][0]+nTds)%10;
					var max=(arr[num][numbers][0]+nTds)%10;
					for (var i = 0; i < 4; i++) {
						if (min>(arr[num][numbers][i]+nTds)%10) {
							min=(arr[num][numbers][i]+nTds)%10;
						};
						if (max<(arr[num][numbers][i]+nTds)%10) {
							max=(arr[num][numbers][i]+nTds)%10;
						};					
					};				
					// 按左箭头键
					if (e.keyCode == 37) {
						
						if (min>0) {
							
							for (var i = 0; i < 4; i++) {
								$('td').eq((arr[num][numbers][i]+nTds)).removeClass('active');
							};
							var bHasClassL1=$('td').eq(arr[num][numbers][0]+nTds-1).hasClass('active');
							var bHasClassL2=$('td').eq(arr[num][numbers][1]+nTds-1).hasClass('active');
							var bHasClassL3=$('td').eq(arr[num][numbers][2]+nTds-1).hasClass('active');
							var bHasClassL4=$('td').eq(arr[num][numbers][3]+nTds-1).hasClass('active');
							if (bHasClassL1==false &&bHasClassL2==false &&bHasClassL3==false &&bHasClassL4==false ) {
								nTds=nTds-1;
								for (var i = 0; i < 4; i++) {
									$('td').eq((arr[num][numbers][i]+nTds)).addClass('active');
								};
								min--;	
							}else{
								for (var i = 0; i < 4; i++) {
									$('td').eq((arr[num][numbers][i]+nTds)).addClass('active');
								};	
							}
							
						}
					};
					//右方向键
					if (e.keyCode == 39 ) {
						
						if (max<9) {
							for (var i = 0; i < 4; i++) {
								$('td').eq((arr[num][numbers][i]+nTds)).removeClass('active');
							};
							var bHasClassR1=$('td').eq(arr[num][numbers][0]+nTds+1).hasClass('active');
							var bHasClassR2=$('td').eq(arr[num][numbers][1]+nTds+1).hasClass('active');
							var bHasClassR3=$('td').eq(arr[num][numbers][2]+nTds+1).hasClass('active');
							var bHasClassR4=$('td').eq(arr[num][numbers][3]+nTds+1).hasClass('active');
							if (bHasClassR1==false && bHasClassR2==false &&bHasClassR3==false &&bHasClassR4==false ) {
								nTds=nTds+1;
								for (var i = 0; i < 4; i++) {
									$('td').eq((arr[num][numbers][i]+nTds)).addClass('active');
								};
								max++;	
							}else{
								for (var i = 0; i < 4; i++) {
									$('td').eq((arr[num][numbers][i]+nTds)).addClass('active');
								};	
							}
							
							
						}
					};
					//下方向键
					if (e.keyCode == 40) {
						if (arr[num][numbers][3]+nTds<190) {
							for (var i = 0; i < 4; i++) {
								$('td').eq((arr[num][numbers][i]+nTds)).removeClass('active');
							};
							var bHasClassB1=$('td').eq(arr[num][numbers][0]+nTds+10).hasClass('active');
							var bHasClassB2=$('td').eq(arr[num][numbers][1]+nTds+10).hasClass('active');
							var bHasClassB3=$('td').eq(arr[num][numbers][2]+nTds+10).hasClass('active');
							var bHasClassB4=$('td').eq(arr[num][numbers][3]+nTds+10).hasClass('active');
							if(bHasClassB1==false && bHasClassB2==false &&bHasClassB3==false && bHasClassB4==false){
								nTds=nTds+10;
								for (var i = 0; i < 4; i++) {
									$('td').eq((arr[num][numbers][i]+nTds)).addClass('active');
								};
							}else{
								for (var i = 0; i < 4; i++) {
									$('td').eq((arr[num][numbers][i]+nTds)).addClass('active');
								};
							};
						};
					};
					//上方向键
					if (e.keyCode == 38) {
						for (var i = 0; i < 4; i++) {
							$('td').eq((arr[num][numbers][i]+nTds)).removeClass('active');
						};
						//
						numbers=numbers+1;					
						if (numbers>=4) {
							numbers=0;
						};
						//假设旋转后,有重叠图层,则不旋转
						var bHasClassC1=$('td').eq(arr[num][numbers][0]+nTds).hasClass('active');
						var bHasClassC2=$('td').eq(arr[num][numbers][1]+nTds).hasClass('active');
						var bHasClassC3=$('td').eq(arr[num][numbers][2]+nTds).hasClass('active');
						var bHasClassC4=$('td').eq(arr[num][numbers][3]+nTds).hasClass('active');
						var min2=(arr[num][numbers][0]+nTds)%10;
						var max2=(arr[num][numbers][0]+nTds)%10;
						for (var i = 0; i < 4; i++) {
							if (min2>(arr[num][numbers][i]+nTds)%10) {
								min2=(arr[num][numbers][i]+nTds)%10;
							};
							if (max2<(arr[num][numbers][i]+nTds)%10) {
								max2=(arr[num][numbers][i]+nTds)%10;
							};					
						};
						if (bHasClassC1==false &&bHasClassC2==false &&bHasClassC3==false &&bHasClassC4==false&&
							(max2-min2)<4) {//(max2-min2)<4 靠边距离不够旋转怎不旋转
							for (var i = 0; i < 4; i++) {
								$('td').eq((arr[num][numbers][i]+nTds)).addClass('active');
							};	
						}else{
							numbers=numbers-1;
							if (numbers<0) {
								numbers=3;
							};
							for (var i = 0; i < 4; i++) {
								$('td').eq((arr[num][numbers][i]+nTds)).addClass('active');
							};
						}
						
					};

				});	
			})
			











		});
	</script>
</head>
<body>
<p>箭头键控制,点击开始</p>
<p>积分为:0</p>
	<div class="Box">
		<table>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<br>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<br>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<br>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<br>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<br>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<br>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<br>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<br>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<br>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<br>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<br>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<br>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<br>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<br>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<br>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<br>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<br>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<br>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<br>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<br>
		</table>
		
		<button class="btn">点击开始</button>	
	</div>
	
</body>
</html>






















